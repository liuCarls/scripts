!function(){"use strict";angular.module("zhxTabFrame",[]),angular.module("zhxTabFrame").provider("zhxFrame",function(){var t={dataUrl:"",dataSrc:"data",dataFormat:{name:"name",order:"order",icon:"icon",moduleName:"moduleName",template:"template",children:"children"},logoUrl:"",logoText:"LOGO",logoWidth:200,headerHeight:45,settingWidth:60,footerHeight:30,settingMenuTplUrl:"tpl/settingMenu.html",navigationWidth:200,isShowFooter:!1};this.config=function(e){t=angular.merge({},t,e)},this.$get=function(){return{getDataUrl:function(){return t.dataUrl},getDataSrc:function(){return t.dataSrc},getDataFormat:function(){return t.dataFormat},getLogoUrl:function(){return t.logoUrl},getLogoText:function(){return t.logoText},getLogoWidth:function(){return t.logoWidth},getHeaderHeight:function(){return t.headerHeight},getNavWidth:function(){return t.navigationWidth},getSettingWidth:function(){return t.settingWidth},isShowFooter:function(){return t.isShowFooter},getSettingMenuTplUrl:function(){return t.settingMenuTplUrl}}}}),angular.module("zhxTabFrame").service("zhxTabTools",function(){var t={};return t.newId=function(){var t,e,i,a,n="";t=(new Date).getTime(),e=parseInt(1e3*Math.random(1,1e3)),i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";for(var o=0;o<5;o++)n+=i.charAt(Math.floor(52*Math.random()));return a=String(e+t)+n,"tab-"+a.substr(5)},t}),angular.module("zhxTabFrame").directive("zhxMainFrame",["$http","zhxFrame",function($http,zhxFrame){return{restrict:"AE",replace:!0,transclude:!0,controller:["$scope",function($scope){$scope.navs=[],$scope.tabsNav=[],$scope.showSlideSetting=!1,$scope.slideSettingWidth=zhxFrame.getSettingWidth(),$scope.logoWidth=zhxFrame.getLogoWidth(),$scope.dataFormat=zhxFrame.getDataFormat(),$scope.dataSrc=zhxFrame.getDataSrc();var dataUrl=zhxFrame.getDataUrl();return""==dataUrl?(console.warn("未指定加载模块数据的URL地址，请在zhxFrameProvider的Config中指定dataUrl."),!1):($scope.navOffsetLeft=0,$http.get(dataUrl).then(function(result){var resData=eval("result."+$scope.dataSrc);if(resData.length){for(var i=0;i<resData.length;i++)$scope.tabsNav.push(resData[i][$scope.dataFormat.children]);$scope.navs=resData}},function(t){console.warn("数据加载错误或加载失败！")}),this.setNavOffset=function(t){$scope.navOffsetLeft=-t},this.showSlideSetting=function(t){$scope.showSlideSetting=t},void(this.getSlideSettingStatus=function(){return $scope.showSlideSetting}))}],link:function(t,e,i){angular.element(e).on("click",function(e){t.showSlideSetting&&"zhx-slide-settings"!=$(e.target)[0].id&&(t.showSlideSetting=!1,t.$digest())})},template:"<ng-transclude ng-style='{ left : showSlideSetting ? -slideSettingWidth : 0 }' id='zhx-frame-wrapper'></ng-transclude>"}}]),angular.module("zhxTabFrame").directive("zhxHead",["zhxFrame",function(t){return{restrict:"AE",replace:!0,require:"^zhxMainFrame",link:function(e,i,a,n){e.logoText=t.getLogoText(),e.headerHeight=t.getHeaderHeight(),e.settingMenuUrl=t.getSettingMenuTplUrl(),e.dateFormat=t.getDataFormat(),e.isActiveTab=0,e.navTheTabs=function(i,a){var o=t.getNavWidth();n.setNavOffset(a*o),e.isActiveTab=a},e.showSlideSetting=function(t){t.stopPropagation(),n.getSlideSettingStatus()?n.showSlideSetting(!1):n.showSlideSetting(!0)}},template:'<header ng-style="{ height : headerHeight }"><div id="logo" ng-style="{ width: logoWidth }">{{ logoText }}</div><div id="header-nav-bar"><ul><li ng-repeat="n in navs" ng-click="navTheTabs($event,$index);" ng-class="{isActiveTab : isActiveTab == $index }">{{ n[dateFormat.name] }}</li></ul></div><div id="header-control" ng-click="showSlideSetting($event);" style="cursor:pointer;" class="zhx-icon-font icon-moreandroid"></div><div id="zhx-slide-settings" ng-style="{ right : $parent.showSlideSetting ? 0 : -$parent.slideSettingWidth, width: $parent.slideSettingWidth }"><div ng-include="settingMenuUrl"></div></div></header>'}}]),angular.module("zhxTabFrame").directive("zhxTabSet",["$timeout","zhxFrame",function(t,e){return{restrict:"AE",replace:!0,controller:["$scope",function(t){var i=this;t.tabs=[],t.isCreatedTabs=[],t.childrenTabs=[],t.tabsWidth=0,t.tabsTipWrapWidth=0,t.scrollLeft=0,t.toggleTipWidth=40,t.contextMenu={},t.createdContextMenu=!1,t.dateFormat=e.getDataFormat(),t.$watch("tabsWidth",function(e,i){e>t.tabsTipWrapWidth?t.hasToogleLeft=t.hasToogleRight=!0:(t.hasToogleLeft=t.hasToogleRight=!1,t.scrollLeft=0)}),t.$watch("tabsTipWrapWidth",function(e,i){e!==i&&e<t.tabsWidth?t.hasToogleLeft=t.hasToogleRight=!0:(t.hasToogleLeft=t.hasToogleRight=!1,t.scrollLeft=0)}),i.selectTab=function(e){angular.forEach(t.tabs,function(t){t.selected=!1}),e.selected=!0},i.pushTab=function(e){t.tabs.push(e)},i.pushCreatedTab=function(e){t.isCreatedTabs.push(e)},i.openChildTab=function(e){angular.forEach(t.childrenTabs,function(t){t!==e?(t.childHeight=0,t.isShowChild=!1):e.isShowChild?(e.isShowChild=!1,e.childHeight=0):(e.isShowChild=!0,e.childHeight=47*e.childrenLen)})},i.openFatherTab=function(e){angular.forEach(t.childrenTabs,function(t){t.childHeight=0,t.isShowChild=!1,t.$id==e&&(t.isShowChild=!0,t.childHeight=47*t.childrenLen)})},i.pushChildTab=function(e){t.childrenTabs.push(e)},i.removeCreatedTab=function(e){if(t.isCreatedTabs.length>1)for(var a=0;a<t.isCreatedTabs.length;a++)t.isCreatedTabs[a]==e&&(e.selected&&(a<t.isCreatedTabs.length-1?i.selectTab(t.isCreatedTabs[a+1]):i.selectTab(t.isCreatedTabs[t.isCreatedTabs.length-2])),t.isCreatedTabs.splice(a,1));else i.selectTab(t.isCreatedTabs[0]),t.isCreatedTabs=[]},i.getCreatedTabs=function(){return t.isCreatedTabs},i.isLastCreatedTab=function(e){return t.isCreatedTabs[t.isCreatedTabs.length-1]==e},i.addTabsWidth=function(e){t.tabsWidth+=e},i.substractTabsWidth=function(e){t.tabsWidth-=e},i.getTabsWidth=function(){return t.tabsWidth},i.getTabTipWrapWidth=function(){return t.tabsTipWrapWidth},i.setScrollLeft=function(e){t.hasToogleLeft&&t.hasToogleRight&&(t.scrollLeft+=e)},i.getScrollLeft=function(){return t.scrollLeft},i.getToggleTipWidth=function(){return t.toggleTipWidth},i.getTipWrapWidth=function(){return t.tabsTipWrapWidth},i.createContextMenu=function(e){t.contextMenu=e,t.createdContextMenu=!0},i.hasToggleLR=function(){return t.hasToogleLeft&&t.hasToogleRight},i.removeContextMenu=function(){$.isEmptyObject(t.contextMenu)||t.contextMenu.$destroy(),t.createdContextMenu=!1}}],link:function(i,a,n,o){i.navigationWidth=e.getNavWidth();var l=document.documentElement.clientWidth;i.tabsTipWrapWidth=l-i.navigationWidth;var r={};$(window).on("resize",function(){t.cancel(r),r=t(function(){var t=document.documentElement.clientWidth,e=t-i.navigationWidth;i.tabsTipWrapWidth=e;var a=e-(o.getTabsWidth()-Math.abs(o.getScrollLeft()))-2*o.getToggleTipWidth();a>0&&o.setScrollLeft(a+5)},300)}),i.$parent.autoOpenTab=function(e){t(function(){$("#zhx-tabset-navigation li:nth("+(e-1)+")").trigger("click")},10)}},template:'<div id="zhx-tabset-wrap"><div id="zhx-tabset-navigation" ng-style="{ width : navigationWidth,minWidth : navigationWidth }"><div id="nav-wrapper" ng-style="{ left : navOffsetLeft }"><ul ng-repeat="n in tabsNav" ng-style="{ width: navigationWidth }" ><tabf ng-repeat="t in n" title="t[dateFormat.name]" tpl-module="t[dateFormat.moduleName]" tpl-url="t[dateFormat.template]" children="t[dateFormat.children]" father="$id"></tabf></ul></div></div><div id="zhx-tabset-content"><div id="zhx-tabset-content-tabs" ng-show="isCreatedTabs.length"><toogle-tip class="zhx-icon-font icon-pullleft" ng-style="{ \'width\' : toggleTipWidth }" id="toogleLeft" ng-if="hasToogleLeft" ng-click="scrollTabs(\'left\')"></toogle-tip><ul ng-style="{ \'left\': scrollLeft }" ng-class="{ toogleLeftShow:hasToogleLeft }"></ul><toogle-tip class="zhx-icon-font icon-pullright" ng-style="{ \'width\' : toggleTipWidth }" id="toogleRight" ng-if="hasToogleRight" ng-click="scrollTabs(\'right\')"></toogle-tip></div><div id="zhx-tabset-content-main"></div></div></div>'}}]),angular.module("zhxTabFrame").directive("tabf",["$compile","$timeout",function(t,e){return{restrict:"E",scope:{title:"=",tplModule:"=",tplUrl:"=",children:"=",father:"="},replace:!0,require:"^zhxTabSet",template:"<div ng-class='{ \"tab-slide-menu\" : childrenLen }' ><div ng-if='childrenLen' ng-click='showSlideMenu($event)' ng-class='{ isChildActive : isShowChild }'><span class='zhx-icon-font icon-right' ng-class='{ iconRotated : isShowChild }'></span>{{ title }}</div><ul ng-class='{ isChild : childrenLen,activeChild: isShowChild }' ng-style='{ height: childHeight, overflow: \"hidden\" }' ng-if='childrenLen'>"+'<tab ng-repeat="c in children" title="c.name" tpl-module="c.tplModule" tpl-url="c.tplUrl" is-child="childrenLen" father="father"></tab></ul><tab ng-if="!childrenLen" title="title" tpl-module="tplModule" tpl-url="tplUrl" is-child="childrenLen"></tab></div>',link:function(t,e,i,a){t.isShowChild=!1,t.childHeight=0,t.childrenLen=t.children.length,t.children.length&&a.pushChildTab(t),t.showSlideMenu=function(e){a.openChildTab(t)}}}}]),angular.module("zhxTabFrame").directive("tab",["$compile","$timeout","$ocLazyLoad","zhxTabTools",function(t,e,i,a){return{restrict:"E",scope:{title:"=",tplModule:"=",tplUrl:"=",isChild:"=",father:"="},replace:!0,template:"<li ng-click='select($event,\"nav\")' ng-class='{active : selected && !isChild,childActive : selected && isChild, isChild : isChild }' style='cursor:pointer;'> <span class='zhx-icon-font icon-right' ng-if='!isChild'></span>{{ title }}</li>",require:"^zhxTabSet",link:function(i,n,o,l){n.attr("title",i.title),i.tabId=a.newId();var r={};i.isCreated=!1,l.pushTab(i),i.select=function(a,n){if(a.stopPropagation(),i.isCreated)l.selectTab(i),l.openFatherTab(i.father+1);else{r=i.$new(),l.selectTab(i);var o=t('<div ng-show="selected"><div oc-lazy-load="tplModule"><ng-include src="tplUrl">if you see this, it means contents is not be loaded</ng-include></div></div>')(r);$(o).addClass(i.tabId),$(o).appendTo("#zhx-tabset-content-main");var s=t('<li style="cursor:pointer" ng-click="select($event,\'tabs\')" ng-right-click="contextMenu($event);" ng-class="{ smallActive: selected }">{{ title }}<span class="zhx-icon-font icon-close" style="cursor:pointer" ng-click="closeTab(\''+i.tabId+"',$event);\"></span></li>")(r);$(s).addClass(i.tabId),$(s).appendTo("#zhx-tabset-content-tabs > ul"),e(function(){l.addTabsWidth(angular.element(s).outerWidth()),$("#zhx-tabset-content-tabs > ul").outerWidth(l.getTabsWidth()+5)},0),i.isCreated=!0,l.pushCreatedTab(i)}var c=i.$watch("selected",function(t,o){t&&e(function(){if(l.hasToggleLR()){var t,e=(l.hasToggleLR(),l.getTipWrapWidth()),o=0,r=l.getToggleTipWidth();"nav"==n?t=$("#zhx-tabset-content-tabs > ul").find("."+i.tabId):"tabs"==n&&(t=$(a.target)),angular.forEach(t.prevAll("li"),function(t){o+=t.clientWidth});var s=e-2*r,c=Math.abs(l.getScrollLeft())+e-o-2*r;c>s&&l.setScrollLeft(c-s),c<t.outerWidth()&&l.setScrollLeft(-(t.outerWidth()-c+20))}},10)});e(c,10)},i.closeTab=function(t,a){a.stopPropagation(),e(function(){var e="LI"==a.target.tagName?$(a.target):$(a.target).parent();l.substractTabsWidth(e.outerWidth()),0!==l.getScrollLeft()&&l.setScrollLeft(e.outerWidth()),$("."+t).remove(),l.removeCreatedTab(i),i.isCreated=!1,i.selected=!1,r.$destroy(),l.getCreatedTabs().length||l.substractTabsWidth(l.getTabsWidth())},10)},i.closeOthers=function(t,i){if(l.getCreatedTabs().length>1){var a="."+t;e(function(){$("#zhx-tabset-content-tabs li:not("+a+")").each(function(){var t=$(this);t.find("span").trigger("click")})},50)}},i.closeTabsToRight=function(t,a){if(l.getCreatedTabs().length>1&&!l.isLastCreatedTab(i)){var n="."+t;e(function(){$("#zhx-tabset-content-tabs").find(n).nextAll().each(function(){var t=$(this);t.find("span").trigger("click")})},50)}},i.contextMenu=function(e){e.stopPropagation(),l.removeContextMenu(),$(".zhx-tabset-contextmenu").remove();var a=r.$new();i.tabsEvent=e,i.y=i.tabsEvent.pageY;var n=document.documentElement.clientWidth;i.tabsEvent.pageX+200>n?i.x=n-200:i.x=i.tabsEvent.pageX,i.createdTabsLen=l.getCreatedTabs().length<=1,i.isTheLast=l.isLastCreatedTab(i);var o=t('<div class="zhx-tabset-contextmenu" ng-style="{left:'+i.x+",top:"+i.y+'};"><ul><li ng-click="closeTab(\''+i.tabId+"',tabsEvent);removeThisTip();\" >关闭标签页</li><li ng-click=\"closeOthers('"+i.tabId+'\',tabsEvent)" ng-class="{disabled: createdTabsLen}">关闭其他标签页</li><li ng-click="closeTabsToRight(\''+i.tabId+'\',tabsEvent)" ng-class="{disabled: isTheLast || createdTabsLen}">关闭右侧标签页</li></ul></div>')(a);a.removeThisTip=function(){$(o).remove(),l.removeContextMenu(a),$("body").off("click",a.removeThisTip)},l.createContextMenu(a),$("body").on("click",a.removeThisTip),$(o).appendTo("body")}}}}]),angular.module("zhxTabFrame").directive("toogleTip",function(){return{restrict:"E",require:"^zhxTabSet",link:function(t,e,i,a){var n=a.getToggleTipWidth();t.scrollTabs=function(e){switch(e){case"left":var i=a.getTabTipWrapWidth()-2*n;$.isNumeric(a.getScrollLeft())&&(Math.abs(a.getScrollLeft())<i?t.$parent.scrollLeft-=t.$parent.scrollLeft:t.$parent.scrollLeft+=i);break;case"right":var o=a.getTabsWidth();i=a.getTabTipWrapWidth()-2*n,o-i>i+Math.abs(t.scrollLeft)?a.setScrollLeft(-i):t.$parent.scrollLeft=-(o-i-5);break;default:return void console.warn("The params of scrollTabs method set error.it must be a string 'left' or 'right'. please check.")}}}}}),angular.module("zhxTabFrame").directive("ngRightClick",["$parse",function(t){return function(e,i,a){var n=t(a.ngRightClick);i.bind("contextmenu",function(t){e.$apply(function(){t.preventDefault(),n(e,{$event:t})})})}}])}();